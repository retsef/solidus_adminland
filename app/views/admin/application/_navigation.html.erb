<%#
# Navigation

This partial is used to display the navigation in Administrate.
By default, the navigation contains navigation links
for all resources in the admin dashboard,
as defined by the routes in the `admin/` namespace
%>
<nav class="navbar navbar-vertical fixed-start navbar-expand-md navbar-dark" id="sidebar">
  <div class="container-fluid">

    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarCollapse" aria-controls="sidebarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Brand -->
    <a class="navbar-brand" href="#">
      <img src="<%= image_path("admin/solidus-symbol-light.png") %>" class="navbar-brand-img mx-auto" alt="Solidus">
    </a>

    <!-- User (xs) -->
    <div class="navbar-user d-md-none">

    </div>

    <!-- Collapse -->
    <div class="collapse navbar-collapse" id="sidebarCollapse">
      <ul class="navbar-nav">
        <%# Administrate::Namespace.new(namespace).resources_with_index_route.each do |resource| %>
          <%# if valid_action?(:index, resource) && show_action?(:index, model_from_resource(resource)) %>
            <!--
            <li class="nav-item">
              <%#= link_to(
                display_resource_name(resource),
                resource_index_route(resource),
                class: "nav-link #{nav_link_state(resource)}"
              ) %>
            </li>
            -->
          <%# end %>
        <%# end %>
        
        <li class="nav-item">
          <a class="nav-link" href="#">
            <i class="fe fe-home"></i> Home
          </a>
        </li>

        <%- Rails.application.config.admin_navigation.main_entries.sort_by(&:position).each do |menu_item| %>
          <% if menu_item.children? %>

            <%= render Admin::Navigation::MenuDropdown::Component.new(icon: menu_item.icon, label: menu_item.label, 
                active: menu_item.urls.any? {|u| active_link? u }) do |c| %>
              <%- menu_item.ordered_children.each do |child_menu_item| %>
                <% c.item do %>
                  <li class="nav-item">
                    <%= active_link_to child_menu_item.label, child_menu_item.url, class: 'nav-link' %>
                  </li>
                <% end %>
              <% end %>
            <% end %>

          <% else %>
            <li class="nav-item">
              <%= active_link_to menu_item.label, menu_item.url, class: 'nav-link' %>
            </li>
          <% end %>
        <% end %>
      </ul>

      <!-- Divider -->
      <hr class="navbar-divider my-3">

      <!-- Heading -->
      <h6 class="navbar-heading">Settings</h6>

      <!-- Navigation -->
      <ul class="navbar-nav mb-md-4">
        <li class="nav-item">
          <%- settings_menu_item = Admin::MenuItem.new(label: 'Settings', icon: 'fe fe-settings', children: Rails.application.config.admin_navigation.setting_entries) %>

          <a class="nav-link" href="#sidebarSettings" data-bs-toggle="collapse" role="button" 
              aria-expanded="<%= settings_menu_item.urls.any? {|u| active_link? u } ? 'true' : 'false' %>" aria-controls="sidebarSettings">
            <i class="<%= settings_menu_item.icon %>"></i> <%= settings_menu_item.label %>
          </a>
          <div class="collapse <%= 'show' if settings_menu_item.urls.any?(:active_link?) %>" id="sidebarSettings">
            <ul class="nav nav-sm flex-column">
              <%- settings_menu_item.ordered_children.each do |menu_item| %>
                <% if menu_item.children? %>
          
                  <%= render Admin::Navigation::MenuDropdown::Component.new(icon: menu_item.icon, label: menu_item.label, 
                      active: menu_item.urls.any? {|u| active_link? u }) do |c| %>
                    <%- menu_item.ordered_children.each do |child_menu_item| %>
                      <% c.item do %>
                        <li class="nav-item">
                          <%= active_link_to child_menu_item.label, child_menu_item.url, class: 'nav-link' %>
                        </li>
                      <% end %>
                    <% end %>
                  <% end %>

                <% else %>
                  <li class="nav-item">
                    <%= active_link_to menu_item.label, menu_item.url, class: 'nav-link' %>
                  </li>
                <% end %>
                
              <% end %>
            </ul>
          </div>
        </li>
      </ul>

      <!-- Push content down -->
      <div class="mt-auto"></div>
    </div>
</nav>
